{
    "id":"b3da4071-cd37-4d33-b8e0-ae35a5be39c9",
    "name":"SurvivalAnalysis 1",
    "notebookContent":"---\nipynb_metadata:\n  language_info:\n    name: python\njupystar:\n  version: 0.2.1\n---\n# %%--- [markdown]\n# properties: {}\n# ---%%\n\n### Survival Analysis (Kaplan Meier) Network Study Using Strategus \n# %%--- [markdown]\n# properties: {}\n# ---%%\n##### Research Question - What is the time to first gastrointestinal (GI) bleeding event among patients initiating warfarin therapy?\n# %%--- [markdown]\n# properties: {}\n# ---%%\n##### Step 1 - Import the necessary libraries\n\n# %%--- [jupyter]\n# properties: {}\n# ---%%\n# import libraries\nlibrary(rD2E)\nlibrary(Strategus)\nlibrary(dplyr)\n# %%--- [markdown]\n# properties: {}\n# ---%%\n##### Step 2 - Cohort definition loading\n# %%--- [jupyter]\n# properties: {}\n# ---%%\ntarCohortId <- XX\noutCohortId <- XX\ncompCohortId <- XX # replace XX with the actual cohort ID\ncohorts_set <- c(tarCohortId, compCohortId, outCohortId)\ncohortDefinitionSet <- rD2E::get_cohort_definition_set(cohorts_set)\n# %%--- [markdown]\n# properties: {}\n# ---%%\n##### Step 3 - Define the network study components\n# %%--- [jupyter]\n# properties: {}\n# ---%%\n# Target-Comparator pairs\ncmTcList <- data.frame(\n  targetCohortId = tarCohortId,\n  targetCohortName = \"Immunotherapy + Surgery\",\n  comparatorCohortId = compCohortId,\n  comparatorCohortName = \"Surgery only\"\n)\n\n# Outcome cohort\noutcomeCohortId <- outCohortId\n\n# Set time-at-risk\ntimeAtRisks <- tibble(\n  label = c(\"KM Analysis\"),\n  riskWindowStart = c(1),\n  startAnchor = c(\"cohort start\"),\n  riskWindowEnd = c(0),\n  endAnchor = c(\"cohort end\")\n)\n\n# Define the outcome\noutcomeList <- lapply(seq_len(1), function(i) {\n  CohortMethod::createOutcome(\n    outcomeId = outcomeCohortId,\n    outcomeOfInterest = TRUE\n  )\n})\n\n# Define the T-C-O structure\ntargetComparatorOutcomesList <- list(\n  CohortMethod::createTargetComparatorOutcomes(\n    targetId = cmTcList$targetCohortId,\n    comparatorId = cmTcList$comparatorCohortId,\n    outcomes = outcomeList\n  )\n)\n# %%--- [markdown]\n# properties: {}\n# ---%%\nCreate settings for modules involved in the study\n# %%--- [jupyter]\n# properties: {}\n# ---%%\n# Setup cohort method module\ncmModuleSettingsCreator <- CohortMethodModule$new()\n\ncmAnalysisList <- list(\n  CohortMethod::createCmAnalysis(\n    analysisId = 1,\n    description = \"Kaplan-Meier survival analysis\",\n    getDbCohortMethodDataArgs = CohortMethod::createGetDbCohortMethodDataArgs(\n      studyStartDate = studyStartDate,\n      studyEndDate = studyEndDate\n    ),\n    createStudyPopArgs = CohortMethod::createCreateStudyPopulationArgs(\n      firstExposureOnly = TRUE,\n      removeDuplicateSubjects = \"keep first\",\n      removeSubjectsWithPriorOutcome = FALSE,\n      priorOutcomeLookback = 0,\n      requireTimeAtRisk = FALSE,\n      riskWindowStart = timeAtRisks$riskWindowStart,\n      startAnchor = timeAtRisks$startAnchor,\n      riskWindowEnd = timeAtRisks$riskWindowEnd,\n      endAnchor = timeAtRisks$endAnchor\n    )\n  )\n)\n\ncohortMethodModuleSpecifications <- cmModuleSettingsCreator$createModuleSpecifications(\n  cmAnalysisList = cmAnalysisList,\n  targetComparatorOutcomesList = targetComparatorOutcomesList\n)\n\n# Cohort Generator Module\ncgModuleSettingsCreator <- CohortGeneratorModule$new()\ncohortDefinitionShared <- cgModuleSettingsCreator$createCohortSharedResourceSpecifications(cohortDefinitionSet)\ncohortGeneratorModuleSpecifications <- cgModuleSettingsCreator$createModuleSpecifications()\n# %%--- [markdown]\n# properties: {}\n# ---%%\nCreate the analysis specification object - including all the modules and configurations created above\n# %%--- [jupyter]\n# properties: {}\n# ---%%\n# Final Analysis Spec\nanalysisSpecifications <- createEmptyAnalysisSpecificiations() |>\n  addSharedResources(cohortDefinitionShared) |>\n  addModuleSpecifications(cohortGeneratorModuleSpecifications) |>\n  addModuleSpecifications(cohortMethodModuleSpecifications)\n# %%--- [markdown]\n# properties: {}\n# ---%%\n##### Step 4 - Execute the Strategus study\n# %%--- [jupyter]\n# properties: {}\n# ---%%\nstudy_name <- \"survival_analysis_study\"  # Unique study name\noptions <- create_options(upload_results=TRUE, study_id = study_name) # set a study_id with a unique id\nrD2E::run_strategus_flow(analysisSpecification = analysisSpecifications, options = options)",
    "isShared":false,
    "datasetId":"67f4015c-04f0-4a92-939b-20c361c2e50a"
}