{
  "resourceType": "StructureMap",
  "id": "EQ5D5L-to-OMOP-Measurement",
  "url": "http://example.org/StructureMap/EQ5D5L-to-OMOP-Measurement",
  "version": "1.0.0",
  "name": "EQ5D5L to OMOP Measurement",
  "status": "active",
  "date": "2025-11-28",
  "publisher": "D4L",
  "structure": [
    {
      "url": "http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse",
      "mode": "source"
    },
    {
      "url": "http://hl7.org/fhir/uv/omop/StructureDefinition/Measurement",
      "mode": "target"
    }
  ],
  "group": [
    {
      "name": "EQ5D5L_to_Measurement",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "tgt",
          "type": "Measurement",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "mapEachItem",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "qitem"
            }
          ],
          "rule": [
            {
              "name": "createMeasurement",
              "source": [
                {
                  "context": "qitem",
                  "variable": "qitem"
                },
                {
                  "context": "src",
                  "variable": "src"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "transform": "create",
                  "parameter": [
                    {
                      "value": "Measurement"
                    }
                  ]
                }
              ],
              "rule": [
                 {
                    "name": "mapMeasurementId",
                    "documentation": "Generate a unique OMOP measurement_id.",
                    "source": [
                        {
                            "context": "src",
                            "element": "id",
                            "variable": "measurement_id"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "element": "measurement_id",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "measurement_id"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "mapPatientId",
                    "source": [
                        {
                            "context": "src",
                            "element": "subject",
                            "variable": "patRef"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "element": "person_id",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "patRef"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "measurement_datetime",
                    "source": [
                        {
                            "context": "src",
                            "element": "authored",
                            "variable": "measurement_datetime"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "element": "measurement_datetime",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "measurement_datetime"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "measurement_date",
                    "source": [
                        {
                            "context": "src",
                            "element": "authored",
                            "variable": "measurement_date"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "element": "measurement_date",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "measurement_date"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "measurement_type_concept_id",
                    "source": [
                      {
                          "context": "src",
                          "element": "id",
                          "variable": "measurement_type_concept_id"
                      }
                    ],
                    "target": [
                      {
                          "context": "tgt",
                          "element": "measurement_type_concept_id",
                          "transform": "copy",
                          "parameter": [
                              {
                                  "valueInteger": 45754907
                              }
                          ]
                      }
                    ]
                },
                {
                    "name": "measurement_source_value",
                    "source": [
                      {
                          "context": "src",
                          "element": "id",
                          "variable": "measurement_source_value"
                      }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "element": "measurement_source_value",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "measurement_source_value"
                                }
                            ]
                        }
                    ]
                },
                {
                  "name": "mapMeasurementConceptId",
                  "source":[{
                      "context": "qitem",
                      "variable": "qitem"
                  }],
                  "rule": [
                    {
                      "name": "mobility",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "mobility",
                          "condition": "linkId = 'mobility'"
                        }
                      ],
                      "target": [
                        {
                          "context": "tgt",
                          "element": "measurement_concept_id",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueInteger": 44806412
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "selfCare",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "selfCare",
                          "condition": "linkId = 'self_care'"
                        }
                      ],
                      "target": [
                        {
                          "context": "tgt",
                          "element": "measurement_concept_id",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueInteger": 44806413
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "usualActivities",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "usualActivities",
                          "condition": "linkId = 'usual_activities'"
                        }
                      ],
                      "target": [
                        {
                          "context": "tgt",
                          "element": "measurement_concept_id",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueInteger": 44813555
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "painDiscomfort",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "painDiscomfort",
                          "condition": "linkId = 'pain_discomfort'"
                        }
                      ],
                      "target": [
                        {
                          "context": "tgt",
                          "element": "measurement_concept_id",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueInteger": 44806414
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "anxietyDepression",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "anxietyDepression",
                          "condition": "linkId = 'anxietyDepression'"
                        }
                      ],
                      "target": [
                        {
                          "context": "tgt",
                          "element": "measurement_concept_id",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueInteger": 44813556
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "eqVAS",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "eqVAS",
                          "condition": "linkId = 'eq_vas'"
                        }
                      ],
                      "target": [
                        {
                          "context": "tgt",
                          "element": "measurement_concept_id",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueInteger": 42537274
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "mapValue",
                  "source":[{
                      "context": "qitem",
                      "variable": "qitem"
                  }],
                  "rule": [
                    {
                      "name": "mobility",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "mobility",
                          "condition": "linkId = 'mobility'"
                        }
                      ],
                      "rule": [
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '1'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742346
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '2'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742347
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '3'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742348
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '4'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742349
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '5'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742350
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "self_care",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "self_care",
                          "condition": "linkId = 'self_care'"
                        }
                      ],
                      "rule": [
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '1'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742351
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '2'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742352
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '3'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742353
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '4'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742354
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '5'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742355
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "usual_activities",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "usual_activities",
                          "condition": "linkId = 'usual_activities'"
                        }
                      ],
                      "rule": [
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '1'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742356
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '2'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742357
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '3'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742358
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '4'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742359
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '5'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742360
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "pain_discomfort",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "pain_discomfort",
                          "condition": "linkId = 'pain_discomfort'"
                        }
                      ],
                      "rule": [
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '1'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742361
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '2'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742362
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '3'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742363
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '4'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742364
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '5'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742365
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "anxiety_depression",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "anxiety_depression",
                          "condition": "linkId = 'anxietyDepression'"
                        }
                      ],
                      "rule": [
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '1'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742366
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '2'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742367
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '3'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742368
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '4'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742369
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "condition": "answer.valueCoding.code = '5'"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_concept_id",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueInteger": 742370
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "name": "eq_vas",
                      "source": [
                        {
                          "context": "qitem",
                          "variable": "eq_vas",
                          "condition": "linkId = 'eq_vas'"
                        }
                      ],
                      "rule": [
                        {
                          "source": [
                            {
                              "context": "qitem",
                              "element": "answer[0].valueInteger",
                              "variable": "vasValue"
                            }
                          ],
                          "target": [
                            {
                              "context": "tgt",
                              "element": "value_as_number",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueId": "vasValue"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}