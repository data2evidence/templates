{"id":"c48b4827-0626-450b-96ae-ee22243fbc4c","name":"testFileNode","flow":{"edges":[{"id":"reactflow__edge-a1c23953-e541-4487-9825-2825f8204cc1source_a1c23953-e541-4487-9825-2825f8204cc1_any-fde165da-0723-43c8-8dff-963c49181a76target_fde165da-0723-43c8-8dff-963c49181a76_any","source":"a1c23953-e541-4487-9825-2825f8204cc1","target":"fde165da-0723-43c8-8dff-963c49181a76","sourceHandle":"source_a1c23953-e541-4487-9825-2825f8204cc1_any","targetHandle":"target_fde165da-0723-43c8-8dff-963c49181a76_any"},{"id":"reactflow__edge-fde165da-0723-43c8-8dff-963c49181a76source_fde165da-0723-43c8-8dff-963c49181a76_object-1a256c27-e86e-41d5-bd6d-338f2fe2ee7atarget_1a256c27-e86e-41d5-bd6d-338f2fe2ee7a_any","source":"fde165da-0723-43c8-8dff-963c49181a76","target":"1a256c27-e86e-41d5-bd6d-338f2fe2ee7a","sourceHandle":"source_fde165da-0723-43c8-8dff-963c49181a76_object","targetHandle":"target_1a256c27-e86e-41d5-bd6d-338f2fe2ee7a_any"},{"id":"reactflow__edge-24654764-37c2-41f7-af3c-49745427e80esource_24654764-37c2-41f7-af3c-49745427e80e_object-fde165da-0723-43c8-8dff-963c49181a76target_fde165da-0723-43c8-8dff-963c49181a76_any","source":"24654764-37c2-41f7-af3c-49745427e80e","target":"fde165da-0723-43c8-8dff-963c49181a76","sourceHandle":"source_24654764-37c2-41f7-af3c-49745427e80e_object","targetHandle":"target_fde165da-0723-43c8-8dff-963c49181a76_any"},{"id":"reactflow__edge-c5f4cf18-a331-4384-8f0e-8f602705ce84source_c5f4cf18-a331-4384-8f0e-8f602705ce84_any-24654764-37c2-41f7-af3c-49745427e80etarget_24654764-37c2-41f7-af3c-49745427e80e_any","source":"c5f4cf18-a331-4384-8f0e-8f602705ce84","target":"24654764-37c2-41f7-af3c-49745427e80e","sourceHandle":"source_c5f4cf18-a331-4384-8f0e-8f602705ce84_any","targetHandle":"target_24654764-37c2-41f7-af3c-49745427e80e_any"}],"nodes":[{"id":"fde165da-0723-43c8-8dff-963c49181a76","data":{"name":"SetConstants","description":"Set constants for the flow","python_code":"def exec(myinput):\n  config_file = myinput[\"JsonConfiguration\"].result\n  INPUT_DIR = myinput[\"Processor\"].result\n  ANONYMIZER = myinput[\"R4 Fhir Anonymizer - Mac\"].result # please replace this with the tool of your OS\n  input_dir = Path(INPUT_DIR).resolve()\n  output_dir = input_dir.parent / \"fhir_output\" # or set it as your desired target destination\n  output_dir.mkdir(exist_ok=True)\n  return {\n    \"ANONYMIZER\" : ANONYMIZER,\n    \"CONFIG_FILE\" : config_file,\n    \"INPUT_DIR\" : str(input_dir),\n    \"OUTPUT_DIR\" : str(output_dir)\n  }"},"type":"python_node","width":354,"height":214,"dragging":false,"position":{"x":-1340,"y":100},"selected":false,"dragHandle":"","sourcePosition":"right","targetPosition":"left","positionAbsolute":{"x":-1340,"y":100}},{"id":"1a256c27-e86e-41d5-bd6d-338f2fe2ee7a","data":{"name":"anonymizer","error":true,"result":"{\n  \"error\": true,\n  \"errorMessage\": \"Traceback (most recent call last):\\n  File \\\"/app/flows/dataflow_ui_plugin/nodes.py\\\", line 260, in task\\n    data = exec(code, params)\\n           ^^^^^^^^^^^^^^^^^^\\n  File \\\"<string>\\\", line 22, in <module>\\n  File \\\"<string>\\\", line 4, in exec\\nAttributeError: 'str' object has no attribute 'get'\\n\",\n  \"nodeName\": \"anonymizer\"\n}","description":"Describe the task of node python_node_2","python_code":"import subprocess\n\ndef exec(myinput) -> str:\n    input_dir = myinput[\"SetConstants\"].result.get(\"INPUT_DIR\")\n    ANONYMIZER = myinput[\"SetConstants\"].result.get(\"ANONYMIZER\")\n    output_dir = myinput[\"SetConstants\"].result.get(\"OUTPUT_DIR\")\n\n    config_dir = Path(myinput[\"SetConstants\"].result.get(\"CONFIG_FILE\"))\n    # Get the first (and presumably only) file inside the folder\n    config_file = next(config_dir.glob(\"*\"))\n    print(f\"Take input from {input_dir} anonymize with {ANONYMIZER}, with config at {config_file}, output to {output_dir}\")\n    # Run the anonymizer tool\n    cmd = [\n        \"dotnet\", ANONYMIZER,\n        \"-i\", input_dir,\n        \"-o\", output_dir,\n        \"-c\", str(config_file)\n    ]\n    subprocess.run(cmd, check=True)\n    return output_dir\n    ","errorMessage":"Traceback (most recent call last):\n  File \"/app/flows/dataflow_ui_plugin/nodes.py\", line 260, in task\n    data = exec(code, params)\n           ^^^^^^^^^^^^^^^^^^\n  File \"<string>\", line 22, in <module>\n  File \"<string>\", line 4, in exec\nAttributeError: 'str' object has no attribute 'get'\n"},"type":"python_node","width":350,"height":210,"dragging":false,"position":{"x":-750,"y":100},"selected":false,"dragHandle":"","sourcePosition":"right","targetPosition":"left","positionAbsolute":{"x":-750,"y":100}},{"id":"a1c23953-e541-4487-9825-2825f8204cc1","data":{"file":"configuration-sample.json","name":"JsonConfiguration","error":false,"result":"{\n  \"error\": false,\n  \"errorMessage\": null,\n  \"nodeName\": \"JsonConfiguration\",\n  \"length\": 42,\n  \"type\": \"<class 'str'>\"\n}","encoding":"utf-8","file_type":"json","description":"Describe the task of node file_node_1","errorMessage":null},"type":"file_node","width":350,"height":210,"dragging":false,"position":{"x":-2560,"y":270},"selected":false,"dragHandle":"","sourcePosition":"right","targetPosition":"left","positionAbsolute":{"x":-2560,"y":270}},{"id":"c5f4cf18-a331-4384-8f0e-8f602705ce84","data":{"file":"Patient.000.ndjson","name":"data_file","error":false,"result":"{\n  \"error\": false,\n  \"errorMessage\": null,\n  \"nodeName\": \"data_file\",\n  \"length\": 42,\n  \"type\": \"<class 'str'>\"\n}","encoding":"utf-8","file_type":"ndjson","description":"The node should take a R4/Stu3 ndjson file","errorMessage":null},"type":"file_node","width":350,"height":210,"dragging":false,"position":{"x":-2570,"y":-120},"selected":false,"dragHandle":"","sourcePosition":"right","targetPosition":"left","positionAbsolute":{"x":-2570,"y":-120}},{"id":"24654764-37c2-41f7-af3c-49745427e80e","data":{"name":"Processor","description":"Describe the task of node python_node_6","python_code":"def exec(myinput) -> str:\n    input_folder = Path(myinput[\"data_file\"].result)\n    ndjson_files = list(input_folder.glob(\"*.ndjson\"))\n    if len(ndjson_files) != 1:\n        raise ValueError(f\"Expected exactly one .ndjson file in {input_folder}, found {len(ndjson_files)}\")\n\n    ndjson_path = ndjson_files[0]\n    encoding = \"utf-8\"\n\n    with open(ndjson_path, \"r\", encoding=encoding) as infile:\n      for i, line in enumerate(infile):\n        line = line.strip()\n        if not line:\n          continue\n        data = json.loads(line)\n        save_path = input_folder / f\"{ndjson_path.stem}_{i+1}.json\"\n        with open(save_path, \"w\", encoding=encoding) as f:\n          json.dump(data, f, indent=2)\n    ndjson_path.unlink()\n    \n    return str(input_folder)\n"},"type":"python_node","width":354,"height":214,"dragging":false,"position":{"x":-2040,"y":-130},"selected":false,"dragHandle":"","sourcePosition":"right","targetPosition":"left","positionAbsolute":{"x":-2040,"y":-130}}],"variables":[],"importLibs":["import requests","import json","import os","from pathlib import Path","from time import sleep","import zipfile"]},"createdBy":"ijmqp2sgffy8","createdDate":"2025-10-13T09:16:28.192Z"}