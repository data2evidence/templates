{
  "name": "Artemis",
  "description": "A flow to run ARTEMIS regimen alignment + stats generation and write outputs back to CDM schemas.",
  "edges": [
    {
      "id": "reactflow__edge-51cba923-4db7-4804-a46e-a47a63fc31a0source_51cba923-4db7-4804-a46e-a47a63fc31a0_object-89361be9-e4b7-46cd-9f0e-581c26b3b3dctarget_89361be9-e4b7-46cd-9f0e-581c26b3b3dc_any",
      "source": "51cba923-4db7-4804-a46e-a47a63fc31a0",
      "target": "89361be9-e4b7-46cd-9f0e-581c26b3b3dc",
      "selected": false,
      "sourceHandle": "source_51cba923-4db7-4804-a46e-a47a63fc31a0_object",
      "targetHandle": "target_89361be9-e4b7-46cd-9f0e-581c26b3b3dc_any"
    }
  ],
  "nodes": [
    {
      "id": "51cba923-4db7-4804-a46e-a47a63fc31a0",
      "data": {
        "name": "README",
        "error": false,
        "result": "{\n  \"error\": false,\n  \"errorMessage\": null,\n  \"nodeName\": \"README\",\n  \"length\": null,\n  \"type\": \"<class 'NoneType'>\"\n}",
        "description": "Describe ARTEMIS and list supported conditions.",
        "python_code": "def exec(myinput):\n  \"\"\"\n  ARTEMIS provides an interface for utilizing a modified Temporal Smith-Waterman (TSW) algorithm \n  that is capable of analysing conditions in the following list\n      [1] \"ER Breast cancer\"                                                 \n      [2] \"Prostate cancer\"                                                  \n      [3] \"undefined\"                                                        \n      [4] \"Mantle cell lymphoma\"                                             \n      [5] \"Acute myeloid leukemia\"                                           \n      [6] \"KRAS Colorectal cancer\"                                           \n      [7] \"Non-small cell lung cancer\"                                       \n      [8] \"Non-small cell lung cancer squamous\"                              \n      [9] \"Kaposi sarcoma\"                                                   \n    [10] \"Acute promyelocytic leukemia\"                                     \n    [11] \"Immune thrombocytopenia\"                                          \n    [12] \"Acute myeloid leukemia pediatric\"                                 \n    [13] \"Castleman disease\"                                                \n    [14] \"Endometrial cancer\"                                               \n    [15] \"Myelodysplastic syndrome\"                                         \n    [16] \"Hepatocellular carcinoma\"                                         \n    [17] \"Thyroid cancer differentiated\"                                    \n    [18] \"Chronic myeloid leukemia\"                                         \n    [19] \"T-cell acute lymphoblastic leukemia pediatric\"                    \n    [20] \"Extranodal NK- and T-cell lymphoma nasal type\"                    \n    [21] \"Antiphospholipid antibody syndrome\"                               \n    [22] \"Venous thromboembolism\"                                           \n    [23] \"Systemic mastocytosis\"                                            \n    [24] \"Clear cell renal cell carcinoma\"                                  \n    [25] \"Thyroid cancer medullary\"                                         \n    [26] \"IDH Acute myeloid leukemia\"                                       \n    [27] \"Graft versus host disease\"                                        \n    [28] \"VHL Renal cell carcinoma\"                                         \n    [29] \"Chronic lymphocytic leukemia\"                                     \n    [30] \"Transformed lymphoma\"                                             \n    [31] \"Renal cell carcinoma\"                                             \n    [32] \"Ovarian cancer\"                                                   \n    [33] \"Cutaneous T-cell lymphoma\"                                        \n    [34] \"NRAS Melanoma\"                                                    \n    [35] \"Testicular cancer\"                                                \n    [36] \"HIV-associated lymphoma\"                                          \n    [37] \"BCR::ABL1 B-cell acute lymphoblastic leukemia\"                    \n    [38] \"Multiple myeloma\"                                                 \n    [39] \"Waldenstroem macroglobulinemia\"                                   \n    [40] \"Chronic myeloid leukemia pediatric\"                               \n    [41] \"Gastric cancer\"                                                   \n    [42] \"Colorectal cancer\"                                                \n    [43] \"Pancreatic cancer\"                                                \n    [44] \"ERBB2 Breast cancer\"                                              \n    [45] \"Rectal cancer\"                                                    \n    [46] \"TNBC Breast cancer\"                                               \n    [47] \"Small cell lung cancer\"                                           \n    [48] \"Glioblastoma\"                                                     \n    [49] \"Peripheral T-cell lymphoma\"                                       \n    [50] \"CNS lymphoma\"                                                     \n    [51] \"Head and neck cancer\"                                             \n    [52] \"ROS1 Non-small cell lung cancer\"                                  \n    [53] \"Diffuse large B-cell lymphoma\"                                    \n    [54] \"Breast cancer\"                                                    \n    [55] \"Classical Hodgkin lymphoma\"                                       \n    [56] \"Osteosarcoma\"                                                     \n    [57] \"Cutaneous squamous cell carcinoma\"                                \n    [58] \"Adrenocortical carcinoma\"                                         \n    [59] \"B-cell acute lymphoblastic leukemia pediatric\"                    \n    [60] \"Melanoma\"                                                         \n    [61] \"Light-chain (AL) amyloidosis\"                                     \n    [62] \"B-cell acute lymphoblastic leukemia\"                              \n    [63] \"Rhabdomyosarcoma\"                                                 \n    [64] \"BCR::ABL1 B-cell acute lymphoblastic leukemia pediatric\"          \n    [65] \"Non-Hodgkin lymphoma pediatric\"                                   \n    [66] \"FLT3 Acute myeloid leukemia\"                                      \n    [67] \"NPM1 Acute myeloid leukemia\"                                      \n    [68] \"Thyroid cancer\"                                                   \n    [69] \"Indolent lymphoma\"                                                \n    [70] \"Neuroblastoma\"                                                    \n    [71] \"Papillary renal cell carcinoma\"                                   \n    [72] \"Pancreatic NET\"                                                   \n    [73] \"Myelofibrosis\"                                                    \n    [74] \"Penile cancer\"                                                    \n    [75] \"Cholangiocarcinoma\"                                               \n    [76] \"Non-small cell lung cancer nonsquamous\"                           \n    [77] \"Sickle cell anemia\"                                               \n    [78] \"Marginal zone lymphoma\"                                           \n    [79] \"T-cell prolymphocytic leukemia\"                                   \n    [80] \"Uveal melanoma\"                                                   \n    [81] \"Neuroendocrine tumor\"                                             \n    [82] \"ER|ERBB2 Breast cancer\"                                           \n    [83] \"Malignant solid neoplasm NTRK-mutated\"                            \n    [84] \"Low-grade serous ovarian cancer\"                                  \n    [85] \"Gastrointestinal stromal tumor\"                                   \n    [86] \"WHIM syndrome\"                                                    \n    [87] \"Plasma cell leukemia\"                                             \n    [88] \"Gestational trophoblastic neoplasia\"                              \n    [89] \"Langerhans cell histiocytosis\"                                    \n    [90] \"Malignant solid neoplasm ERBB3-mutated\"                           \n    [91] \"Desmoid tumor\"                                                    \n    [92] \"Thymoma\"                                                          \n    [93] \"MALT lymphoma\"                                                    \n    [94] \"Warm autoimmune hemolytic anemia\"                                 \n    [95] \"Burkitt lymphoma\"                                                 \n    [96] \"Soft tissue sarcoma\"                                              \n    [97] \"Polycythemia vera\"                                                \n    [98] \"Cutaneous basal cell carcinoma\"                                   \n    [99] \"Follicular lymphoma\"                                              \n    [100] \"Smoldering multiple myeloma\"                                      \n    [101] \"Adult T-cell leukemia-lymphoma\"                                   \n    [102] \"Malignant solid neoplasm SMO-mutated or PTCH-1-mutated (Hedgehog)\"\n    [103] \"Low-grade glioma\"                                                 \n    [104] \"Post-transplant lymphoproliferative disorder\"                     \n    [105] \"Primary mediastinal B-cell lymphoma\"                              \n    [106] \"Ewing sarcoma\"                                                    \n    [107] \"RAS Colorectal cancer\"                                            \n    [108] \"Urothelial carcinoma\"                                             \n    [109] \"NK- and T-cell lymphoma\"                                          \n    [110] \"Hairy cell leukemia\"                                              \n    [111] \"Gallbladder cancer\"                                               \n    [112] \"Hodgkin lymphoma nodular lymphocyte-predominant\"                  \n    [113] \"Classical Hodgkin lymphoma pediatric\"                             \n    [114] \"Nasopharyngeal carcinoma\"                                         \n    [115] \"Esophageal squamous cell carcinoma\"                               \n    [116] \"Wilms tumor\"                                                      \n    [117] \"Esophageal cancer\"                                                \n    [118] \"Sarcomatoid renal cell carcinoma\"                                 \n    [119] \"Anaplastic large cell lymphoma pediatric\"                         \n    [120] \"Carcinoma of unknown primary\"                                     \n    [121] \"Hepatoblastoma\"                                                   \n    [122] \"Bladder cancer\"                                                   \n    [123] \"Vulvar cancer\"                                                    \n    [124] \"Paroxysmal nocturnal hemoglobinuria\"                              \n    [125] \"Mismatch repair deficient malignancy\"                             \n    [126] \"PEComa\"                                                           \n    [127] \"High-grade B-cell lymphoma\"                                       \n    [128] \"Blastic plasmacytoid dendritic cell neoplasm\"                     \n    [129] \"Cervical cancer\"                                                  \n    [130] \"Medulloblastoma\"                                                  \n    [131] \"Osteosarcoma pediatric\"                                           \n    [132] \"Pheochromocytoma\"                                                 \n    [133] \"RET Non-small cell lung cancer\"                                   \n    [134] \"Low-grade glioma pediatric\"                                       \n    [135] \"Malignant pleural mesothelioma\"                                   \n    [136] \"Leiomyosarcoma\"                                                   \n    [137] \"Colon cancer\"                                                     \n    [138] \"Hypereosinophilic syndrome\"                                       \n    [139] \"Malignant solid neoplasm ERBB2-mutated\"                           \n    [140] \"KMT2A Acute lymphoblastic leukemia infant\"                        \n    [141] \"PIK3CA Breast cancer\"                                             \n    [142] \"Essential thrombocythemia\"                                        \n    [143] \"Merkel cell carcinoma\"                                            \n    [144] \"T-cell acute lymphoblastic leukemia\"                              \n    [145] \"Rosai-Dorfman-Destombes disease\"  \n  \"\"\"\n",
        "errorMessage": null
      },
      "type": "python_node",
      "width": 350,
      "height": 210,
      "dragging": false,
      "position": { "x": -420, "y": 80 },
      "selected": false,
      "dragHandle": "",
      "sourcePosition": "right",
      "targetPosition": "left",
      "positionAbsolute": { "x": -420, "y": 80 }
    },
    {
      "id": "89361be9-e4b7-46cd-9f0e-581c26b3b3dc",
      "data": {
        "name": "Artemis",
        "error": true,
        "result": "{\n  \"error\": true,\n  \"errorMessage\": \"Traceback (most recent call last):\\n  File \\\"/app/flows/dataflow_ui_plugin/nodes.py\\\", line 295, in task\\n    \\\"myinput\\\": convert_py_to_R(_input), \\\"output\\\": {}}\\n               ^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\"/app/flows/dataflow_ui_plugin/flowutils.py\\\", line 56, in convert_py_to_R\\n    if v.data is not None}\\n       ^^^^^^\\nAttributeError: 'Result' object has no attribute 'data'\\n\",\n  \"nodeName\": \"Artemis\"\n}",
        "description": "Describe the task of node r_node_0",
        "r_code": "library(ARTEMIS)\n\nexec <- function(myinput) {\n    # Set PostgreSQL connection details, replace with your database details\n    connectionDetails <- DatabaseConnector::createConnectionDetails(\n      dbms = \"postgresql\",\n      server = \"localhost/postgres\",\n      user = \"postgres\",\n      password = \"yourpassword\", # replace with your own password\n      port = \"15432\",\n      pathToDriver = \"~/.jdbc\",   # direct to the path of your local jdbc driver\n      extraSettings = \"sslmode=disable\"\n    )\n\n    json <- loadCohort()\n    name <- \"lungcancer\" # replace with desired condition\n\n    validdrugs <- loadDrugs()\n    regimens <- loadRegimens(condition = \"lungCancer\") # replace with one of the conditions in the README\n    regGroups <- loadGroups()\n\n    cdmSchema   <- \"test_lungCancer\"   # input schema\n    writeSchema <- \"demo_cdm_results\"  # output schema\n\n    # Main\n    con_df <- getConDF(\n        connectionDetails = connectionDetails,\n        json = json,\n        name = name,\n        cdmSchema = cdmSchema,\n        writeSchema = writeSchema\n    )\n\n    stringDF <- stringDF_from_cdm(\n        con_df = con_df,\n        writeOut = F,\n        validDrugs = validdrugs\n    )\n\n    output_all <- stringDF %>% generateRawAlignments(\n        regimens = regimens,\n        g = 0.4,\n        Tfac = 0.4,\n        method = \"PropDiff\",\n        verbose = 0\n    )\n\n    processedAll <- output_all %>% processAlignments(\n        regimenCombine = 28,\n        regimens = regimens\n    )\n\n    processedEras <- processedAll %>% calculateEras()\n\n    regStats <- processedEras %>% generateRegimenStats()\n\n    # OUTPUT\n    writeOutputs(\n        output_all,\n        processedAll = processedAll,\n        processedEras = processedEras,\n        connectionDetails = connectionDetails,\n        cdmSchema = cdmSchema,\n        regGroups = regGroups,\n        regStats = regStats,\n        stringDF = stringDF,\n        con_df = con_df\n    )\n}\n",
        "errorMessage": "Traceback (most recent call last):\n  File \"/app/flows/dataflow_ui_plugin/nodes.py\", line 295, in task\n    \"myinput\": convert_py_to_R(_input), \"output\": {}}\n               ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/flows/dataflow_ui_plugin/flowutils.py\", line 56, in convert_py_to_R\n    if v.data is not None}\n       ^^^^^^\nAttributeError: 'Result' object has no attribute 'data'\n"
      },
      "type": "r_node",
      "width": 354,
      "height": 214,
      "dragging": false,
      "position": { "x": 40, "y": 100 },
      "selected": true,
      "dragHandle": "",
      "sourcePosition": "right",
      "targetPosition": "left",
      "positionAbsolute": { "x": 40, "y": 100 }
    }
  ],
  "variables": [
    { "key": "dbms", "value": "postgresql" },
    { "key": "server", "value": "localhost/postgres" },
    { "key": "user", "value": "postgres" },
    { "key": "password", "value": "yourpassword" },
    { "key": "port", "value": "15432" },
    { "key": "pathToDriver", "value": "~/.jdbc" },
    { "key": "extraSettings", "value": "sslmode=disable" },
    { "key": "name", "value": "lungcancer" },
    { "key": "condition", "value": "lungCancer" },
    { "key": "cdmSchema", "value": "test_lungCancer" },
    { "key": "writeSchema", "value": "demo_cdm_results" },
    { "key": "g", "value": 0.4 },
    { "key": "Tfac", "value": 0.4 },
    { "key": "method", "value": "PropDiff" },
    { "key": "verbose", "value": 0 },
    { "key": "regimenCombine", "value": 28 }
  ],
  "importLibs": [
    "library(ARTEMIS)",
    "library(DatabaseConnector)",
    "library(dplyr)"
  ]
}
